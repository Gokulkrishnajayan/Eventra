<!-- Main Content -->
<div class="main-content">
  <!-- Bookings Section -->
  <section id="bookings" class="section-content">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h5 class="fw-bold mb-0">Booking Management</h5>
      <div class="d-flex gap-3">
        <div class="dropdown">
          <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            All Status
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">All Status</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Pending</a></li>
            <li><a class="dropdown-item" href="#">Confirmed</a></li>
            <li><a class="dropdown-item" href="#">Completed</a></li>
            <li><a class="dropdown-item" href="#">Cancelled</a></li>
          </ul>
        </div>
        
        <button class="btn btn-primary d-flex align-items-center gap-2" data-bs-toggle="modal" data-bs-target="#calendarModal">
          <i data-lucide="calendar" class="lucide"></i> Calendar View
        </button>
      </div>
    </div>
    
    <div class="card p-4">
      <div class="table-responsive">
        <table class="table table-enhanced">
          <thead>
            <tr>
              <th>Booking ID</th>
              <th>Customer</th>
              <th>Service</th>
              <th>Date</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% bookings.forEach(booking => { %>
              <tr>
                <td>#EV-<%= booking._id.toString().slice(-4).toUpperCase() %></td>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
                      <i data-lucide="user" class="lucide text-white" style="width: 16px; height: 16px;"></i>
                    </div>
                    <div class="fw-medium"><%= booking.userId?.name || 'Unknown' %></div>
                  </div>
                </td>
                <td><%= booking.serviceId?.[0]?.name || 'N/A' %></td>
                <td><%= booking.date ? booking.date.toISOString().split('T')[0] : '' %></td>
                <td>$<%= booking.totalPrice %></td>
                <td>
                  <span class="badge badge-<%= booking.status.replace(/\s/g, '-').toLowerCase() %>">
                    <%= booking.status.charAt(0).toUpperCase() + booking.status.slice(1) %>
                  </span>
                </td>
                <td>
                  <div class="d-flex gap-2">
                    <% if (booking.status === 'pending') { %>
                      <button class="booking-action-btn confirm-btn" data-booking-id="<%= booking._id %>" title="Confirm">
                        <i data-lucide="check" class="lucide"></i>
                      </button>

                      <button class="booking-action-btn reject-btn" data-booking-id="<%= booking._id %>" title="Reject">
                        <i data-lucide="x" class="lucide"></i>
                      </button>
                    <% } else if (booking.status === 'payment due') { %>
                      <button class="btn btn-sm btn-outline-success" disabled>Awaiting Payment</button>
                    <% } else if (booking.status === 'confirmed') { %>
                      <button class="booking-action-btn complete-btn" data-booking-id="<%= booking._id %>" title="Mark Complete">
                        <i data-lucide="check-circle" class="lucide"></i>
                      </button>
                    <% } else if (booking.status === 'completed') { %>
                      <span class="text-success">Completed</span>
                    <% } else if (booking.status === 'cancelled') { %>
                      <span class="text-danger">Cancelled</span>
                    <% } %>
                  </div>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>
  </section>
</div>



  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Confirm booking â†’ update status to 'payment due'
  document.querySelectorAll('.confirm-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const bookingId = btn.getAttribute('data-booking-id');
      const res = await fetch(`/vendor/booking/confirm/${bookingId}`, { method: 'POST' });
      const data = await res.json();
      if (data.success) window.location.reload();
    });
  });

  // Mark booking as completed
  document.querySelectorAll('.complete-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const bookingId = btn.getAttribute('data-booking-id');
      const res = await fetch(`/vendor/booking/complete/${bookingId}`, { method: 'POST' });
      const data = await res.json();
      if (data.success) window.location.reload();
    });
  });

  // Reject booking
  document.querySelectorAll('.reject-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const bookingId = btn.getAttribute('data-booking-id');
      if (!confirm("Are you sure you want to reject this booking?")) return;
      const res = await fetch(`/vendor/booking/reject/${bookingId}`, { method: 'POST' });
      const data = await res.json();
      if (data.success) window.location.reload();
    });
  });
});
</script>
